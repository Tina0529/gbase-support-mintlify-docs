# GitHub Actions 工作流说明

本目录包含用于自动化管理仓库作者信息的 GitHub Actions 工作流。

## 📋 工作流列表

### 1. `update-author-info.yml` - 基础版本
- **触发条件**: 当 PR 合并到 main 分支时
- **功能**: 自动将所有提交的作者信息更新为 `support@sparticle.com`
- **特点**: 简单直接，适合基本需求

### 2. `update-author-info-advanced.yml` - 高级版本 ⭐ 推荐
- **触发条件**: 当 PR 合并到 main 分支时
- **功能**: 
  - 智能检测是否需要更新作者信息
  - 创建备份分支
  - 详细的日志和错误处理
  - 自动在 PR 中添加评论
  - 生成详细的执行摘要
  - 失败时自动通知

## 🔧 配置说明

### 必要的仓库权限
确保 GitHub Actions 具有以下权限：
- `contents: write` (修改仓库内容)
- `actions: write` (运行工作流)
- `pull-requests: write` (在 PR 中添加评论)

### 环境变量配置
可以在工作流文件中修改以下变量：
```yaml
env:
  TARGET_AUTHOR_NAME: "support@sparticle.com"
  TARGET_AUTHOR_EMAIL: "support@sparticle.com"
```

## 🚀 工作流程

1. **触发**: 当有 PR 被合并到 main 分支时自动触发
2. **检查**: 分析仓库状态，检测是否有需要更新的提交
3. **备份**: (高级版本) 创建备份分支以防意外
4. **更新**: 使用 `git-filter-repo` 更新所有提交的作者信息
5. **推送**: 将更新后的历史推送到 main 分支
6. **通知**: (高级版本) 在 PR 中添加成功/失败通知

## ⚠️ 重要注意事项

### 🔒 安全考虑
- 工作流只在 PR 合并后运行，避免在开发过程中意外修改历史
- 使用 `--force-with-lease` 进行安全的强制推送
- 高级版本包含备份机制和详细的错误处理

### 📊 影响范围
- **历史重写**: 这个操作会重写整个 Git 历史
- **协作影响**: 其他开发者可能需要重新克隆仓库
- **分支保护**: 确保分支保护规则允许强制推送

### 🔄 最佳实践
1. 在生产环境使用前，先在测试仓库中验证
2. 确保团队成员了解历史重写的影响
3. 定期检查工作流运行状态
4. 保留高级版本创建的备份分支以防万一

## 📝 示例场景

### 场景 1: 正常 PR 合并
1. 开发者创建功能分支并提交代码
2. 创建 PR 到 main 分支
3. PR 被审核并合并
4. 工作流自动运行，更新作者信息
5. 在 PR 中添加成功通知

### 场景 2: 无需更新
1. 所有提交已经是正确的作者信息
2. 工作流检测到无需更新
3. 跳过更新步骤，仅记录日志

## 🛠️ 故障排除

### 常见问题
1. **权限不足**: 检查仓库的 Actions 权限设置
2. **并发冲突**: 多个 PR 同时合并时可能出现冲突
3. **网络问题**: GitHub Actions 网络环境导致的临时失败

### 调试方法
1. 查看 Actions 页面的详细日志
2. 检查生成的备份分支
3. 验证 `git-filter-repo` 的输出

## 🔮 未来改进

- [ ] 支持配置不同分支的不同作者信息
- [ ] 添加 Slack/Teams 通知集成
- [ ] 支持批量处理多个分支
- [ ] 增加回滚功能

---

**注意**: 这些工作流会修改 Git 历史，请确保在生产环境使用前充分测试！ 